<!-- omit in toc -->
- [Apex解説](#apex解説)
  - [1. ApexとJavaの違い（影響が大きそうな順？）](#1-apexとjavaの違い影響が大きそうな順)
    - [1.1. 実行環境](#11-実行環境)
    - [1.2. テストのカバレッジ75%以下は本番リリースできない](#12-テストのカバレッジ75以下は本番リリースできない)
    - [1.3. 大文字小文字の区別](#13-大文字小文字の区別)
    - [1.4. 名前空間](#14-名前空間)
    - [1.5. ガバナ制限](#15-ガバナ制限)
    - [1.6. テスト](#16-テスト)
      - [1.6.1. ローカル環境でテスト実施できない](#161-ローカル環境でテスト実施できない)
      - [1.6.2. 既存データでテスト出来ない(正確には可能)](#162-既存データでテスト出来ない正確には可能)
    - [1.7. 文字列が""ではなく''](#17-文字列がではなく)
  - [2. 公式サイトの活用](#2-公式サイトの活用)
    - [2.1. 公式サイト情報](#21-公式サイト情報)
    - [2.2. 見た方が良い場所](#22-見た方が良い場所)
    - [2.3. 補助知識①](#23-補助知識)
    - [2.4. 補助知識②](#24-補助知識)
# Apex解説
## 1. ApexとJavaの違い（影響が大きそうな順？）
本資料では多少Javaに触れた事がある人を想定しているため、まずはApexとJavaの違いを解説する
※逆に？IF文の書き方、FOR文の書き方といったJavaと大差ない基礎部分については本資料で解説しない予定

### 1.1. 実行環境
ApexはSalesforceサーバ上、JavaはJVMで実行可能
Javaはローカル実行やテストが実施できていたが
Apexは一度Salesforce組織にデプロイしてから実行・テストとなるのが大きく異なる
Javaだと

***[Todo]***
Javaだとテストして問題ない状態になったらコミットとかしていたのに
Apexだとそれが出来ないとなると、大規模開発でどういう運用になるか気になる…
同一ファイルを複数人で修正したり、開発途中の状態管理とか…
↓
たぶん機能や担当者ごとにSandboxを分ける
SandboxごとにGitのリポジトリを分ける
担当者用Sandbox→テスト環境用Sandboxにまとめる際に
Gitで競合解消等行ってマージして、テスト環境用でも最終テストとか？

### 1.2. テストのカバレッジ75%以下は本番リリースできない
- そもそも本番環境で直接Apexを作成できない
- 本番以外のSandbox等の環境で、事前に作成＋テストを実施して変更セット経由で本番リリース
- 変更セットを作成する時点で、テストのカバレッジが75%以下だとそもそもエラーとなる

**補足**
ノーチェックでもリリースできてしまうよりは、事前チェックがあるのは健全
75%だから品質OKとは判断できない（ロジック偏らせれば、IF文スルーしても75%は達成可能）
⇒実際の案件だと品質指標値とか決まっていると思うので、それに従うが良
　ただ100%に拘って非効率になるのは個人的には反対（100%容易ならやるべきだけど）

### 1.3. 大文字小文字の区別
Javaでは大文字小文字が区別されますが、Apexでは区別されません。
クラス名や変数名をつけるときに注意が必要。
※名前が被ったり、クラス名が小文字始まりみたいな可読性低下につながる部分とか…

### 1.4. 名前空間
Javaでは名前空間(package)という概念が存在しますがApexでは存在しない※結構重要

***■具体例***
・Javaの場合
SampleClassというクラスを以下の様に別の名前空間として管理可能
①SampleProject.AAA.SampleClass
②SampleProject.BBB.SampleClass
⇒少しレベルを下げる？とJavaはフォルダ構成を意識する必要があるし
　逆にフォルダ構成をたどれば、どこにどういう機能が配置されているか察することが可能

・Apexの場合
もしSampleClsssというクラスをフォルダを分けて作成してデプロイしようと思ってもNG
※正確にはパッケージ利用すれば同一クラス名も管理できるらしいけど

**■具体例**
ローカル環境でAフォルダにクラスA、BフォルダにクラスBを作成してデプロイする
↓
Salesforce上ではApex Classesというフォルダにまとめて配置される

もし別PCでプロジェクトを新規作成して
「[プロジェクト名]\force-app\main\default\classes」フォルダが空の状態で
ソースを組織から取得を実施すると
classesフォルダ直下に、クラスAもクラスBも配置される
※もしclassesフォルダに、Aフォルダ→クラスA、Bフォルダ→クラスBという空ファイルを配置して
　ソースを組織から取得を実施すると、自動的にクラスA、クラスBの中身がリンクして最新化される

### 1.5. ガバナ制限
Salesforceはマルチテナントクラウドというアーキテクチャを採用しており
（イメージ：データセンター内にサーバが複数あり、その内の1つをTSSが間借りしてる。間借りしてる空間には他社さんもいる）
1つのSalesforce組織が無制限に処理負荷をかけたプログラムが実行できてしまうと、他組織にも影響を与えてしまう

そのためSalesforceではガバナ制限として、プログラムの実行にある程度の制限をかけている。
- DML制限：1トランザクションで150件DML操作するとエラー
- クエリ数：非バルク化なら1トランザクション100件のSOQL実施
- クエリの行数：1回のSELECTで取得できるのは5万件まで
その他いろいろ…

**■具体例**
アンチパターンでよくある、ループ文の中でSELECT実行とかは
Javaだと処理負荷が高くなるけど一応は動く
Salesforceだと150件超えたタイミングでエラーが発生する。
しかもTry,catch,finalyとかでエラー処理を実装していたとしても
それを無視して全件ロールバックエラーという挙動になる。
↓
ガバナ制限を意識しないと、思わぬところで動かなくなるので
Salesforce開発者的には結構意識しないといけない部分なはず

### 1.6. テスト

#### 1.6.1. ローカル環境でテスト実施できない
実行環境とも被るが、ApexはSalesforceサーバ上で動くため
ローカル環境ではテスト実施できず、組織へデプロイ→テスト実施という流れになる

#### 1.6.2. 既存データでテスト出来ない(正確には可能)
Javaの開発だと環境設定ファイルとかに
単体テスト用とか結合テスト用といったDBとの接続設定がされている事が多く
テスト前？に動作確認するときは、既にDBに入っているデータで確認…というパターンがまぁまぁある

しかしSalesforceのテストでは、一貫性・独立性が重視されているので
テストクラス側でテストデータを作成することがベストプラクティスとなっている

そのため、実装→テストで動作確認する際
Sandboxに既に登録されているデータが拾われるはず…と思っていると
データが拾われず、デバッグしてもデータ取得できないのでコーディングミス？？と勘違いしてハマる可能あり
⇒テストクラスに特殊なアノテーションをつけると既存データは使えるけど非推奨

### 1.7. 文字列が""ではなく''
Javaだとcharが存在するので、1文字=''　文字列=""だったけれど
Apexはcharが存在しないので、1文字だろうが文字列だろうが''で記載する必要あり
⇒意識せず""を書いてしまう人からすると、少し煩わしい違い
　（VSCode上でエラーになるから良いけど、毎回毎回…慣れた頃にJavaに戻ると…でストレス）

## 2. 公式サイトの活用

### 2.1. 公式サイト情報
[①Apexのポータル](https://developer.salesforce.com/developer-centers/apex)

[②Apex開発者ガイドの日本語版](https://developer.salesforce.com/docs/atlas.ja-jp.252.0.apexcode.meta/apexcode/apex_dev_guide.htm)
②はポータルから移動して日本語選択した際のURLを張っただけ
　中身がWinter25のバージョンなので、参照するタイミングによっては古い可能性あり
　⇒普通にポータル経由で見た方が良い気がする

### 2.2. 見た方が良い場所
[Apexの使用開始＞Apex開発プロセス＞Apexに関する説明](https://developer.salesforce.com/docs/atlas.ja-jp.apexcode.meta/apexcode/apex_intro_learning_apex.htm)

- Trailheadのコンテンツ紹介
- 重要なメニューの紹介

↑これらが公式で用意されているので参考にしながら進めるのが良いかも

### 2.3. 補助知識①
SalesforceでApexを実装するには主に2パターンあり
1. Salesforceの設定ページ（カスタムコード>Apex〇〇とか）から
2. VSCodeにSalesforce用の拡張機能を追加してから

**どちらを利用したほうが良いか？**
TSSとか関係なく、Salesforceメインであれば正直どちらでも良いと思う
Trailheadとかの内容を愚直にやるなら、自然とパターン1で進めることになるはず？
パターン2で進めても、結局はSalesforceにデプロイしてCLI経由で実施・テストしてるので、やってることは大差ない

**ただ、個人的にはパターン2の方が良い気がする**
VSCode自体が一般的なツールなので、慣れておけば他にも応用が利く
-- 基本的な操作方法（同じIDEでもEclipseしか経験ない人がVSCode使うと満足に操作できないし）
-- ショートカットキーとか覚えて生産性が上がる
-- 拡張機能の導入とかの流れとかが分かる
-- プログラミング言語に関わらない知識が覚えられる（設定、デバッグetc）
⇒Salesforceだけ、ApexだけならSalesforce環境だけ分かれば良いけど
　TSSならSalesforce以外にも触れる機会が多そうなので、VSCodeも一緒に覚えながらが良いと思う

**確認していないこと**
Trailheadを進めるときに、だいたいPlaygroundに特定のクラス作成することになると思う
これをVSCodeから進める方法が未確認

Playground自体もユーザ、パスワードは確認できるはずなので
理論的にはアクセスして、課題通りのクラス作成すれば課題達成できるはず
※正直自分はTrailheadの説明文が苦手だし、技術系であれば
　ソースと概念図っぽいものがあれば何となく察することが出来るので
　Trailheadのソースは眺めるけど、課題自体は取り込まない方針（気になる機能はSandboxで動作確認するし…）

### 2.4. 補助知識②
**技術系に取り組むときの心構え**
1. ソースの手書き？にこだわらない
Webページとか書籍の情報をインプットにプログラミング言語を勉強するとき
手を動かさないと覚えない、コピペはズル…みたいな意識があると、いちいち手打ちしがち
⇒かなり時間がかかるし、もっと時間をかけた方が良い事があるので
　コピペ出来るのであればやっちゃって良いと思う

2. 写経で終わらせない
サンプルソースを一字一句真似→動いた→満足＝ほとんど意味が無い
最悪は完全一致するサンプルが無いと実装出来ない人になる
もしくは少し修正すれば動くようなサンプルが無いと実装出来ない人になりがち
⇒ソースは手打ちするし、一字一句真似して終わるタイプは最悪（時間も成果も…）

3. サンプル内でアレンジしてみる
   クラス名をアレンジしてみる
   変数名をアレンジしてみる
   ロジックをアレンジしてみる（文字出力なら内容かえたり、結合してみたり）
⇒サンプルの内容によっては、クラスをまたいで変数やメソッド名を統一してたりすると
　どこのソースがどこに効いてる？とか把握しづらいパターンもあったりする

4. あえてエラーにしてみる（遊び心、好奇心？）
   〇〇と書くルール、□□のように動く…というときに
   ＸＸと書くとどうなるんだろう？あえてエラーにするにはどうするのだろう？と
   色々な事を考えて試してみると、より理解が深まります
   そもそもコンパイルエラーになっちゃうのねーという時もあれば
   あれ？普通に動くじゃんという時もある

5. デバッグしてみる
   1ステップずつソースを動かして、変数の入り方
   データ構造のうち、自分が利用してない項目がどうなってるか…とか色々見てみる

6. 自分が使いそうな具体例を考えて実装してみる
   例えばSELECTのSOQLを勉強するときに、以下のようなサンプルをよく見かけるけど
   ~~~
   SELECT Name,Phone FROM Account WHERE Name='Sample';
   ~~~
   ⇒Nameって一意だし、こんな実装する場面まず無いなーと考えて
   　・せめて会社の規模（従業員数とか利益とか）とかで検索するよなー
   　・複数件検索するのだから、普通にソートしたくなるよなー
   　・ガバナ制限で取得件数に上限あるみたいだから、取得件数絞らないとー
   　・1回の取得上限より多い件数取得したい時もあるよなー
   　・そもそも固定値検索する場面の方が少ないような？メソッドの引数で検索できないかなー
   といったように「実際に使いそうなケースを考える⇒調べる⇒実装する」を行うと成長が早い…はず。
   たぶん自走する力とか言われたりするやつ？
   これが出来ないと一通り書籍は読んだけど結局何ができるようになったか分からないとか
   ググってピンポイントなサンプルが出てこないと解決できない…というケースに陥りがち

   ピンポイントなサンプルソースが無くても、以下のようなリファレンスを見て出来るかなーと試したり
   近しい事を実施しているサンプル（アイディア）を参考に、こういう方向性で出来ないかなー
   [Apex言語のリファレンス](https://developer.salesforce.com/docs/atlas.ja-jp.apexcode.meta/apexcode/apex_reference.htm)


**自分で具体例考えて試行錯誤することが苦手な人向け（少し脱線）**
Salesforceではあまり使えませんが、JavaScriptとかメジャーな言語では
youtubeで〇〇のクローンサイトを作ってみた（大体海外動画）という物があるので
それを一字一句写経してみるのはありかもしれない
⇒それこそSlack、Youtubeみたいにお金取れるレベルのアプリのクローンもあったりするので
　一字一句写経になったとしても、実践的な内容が多いはずなので経験値になるはず。

[Slackのクローン](https://www.youtube.com/watch?v=lXITA5MZIiI)
Nextjs：JavaScriptでバックエンド側
React：JavaScriptのライブラリ/フレームワーク
Tailwind：CSSのフレームワーク
Auth.js：認証・認可関係 
動画としては15時間もあるけど、上記の有名どころの技術要素押さえて作るっぽいので
写経をするだけでもかなり実力は身につくはず
※書いてる人は視聴したことすら無いけど（いつかは見てみるリスト）